# vim: set ft=yaml :
#
# https://taskfile.dev


version: '3'

set: ['errexit', 'nounset', 'pipefail']

includes:

  # https://changit.bwh.harvard.edu/nhlmi/manselmi-toybox/tree/main/local/Users/nhlmi/.taskfile/include/uv
  uv:
    taskfile: '{{ env "TASKFILE_INCLUDE_ROOT_DIR" }}/uv'
    vars:
      PYTHON_MINOR_VERSION: '3.11'

tasks:

  build:
    aliases: ['default']
    deps: ['uv:venv']
    vars:
      DBT: '{{ .VENV | shellQuote }}/bin/dbt'
    cmds:
      - '{{ .DBT }} deps'
      - '{{ .DBT }} seed'
      - '{{ .DBT }} run'
      - '{{ .DBT }} test'

  mf-validate:
    deps: ['uv:venv']
    vars:
      MF: '{{ .VENV | shellQuote }}/bin/mf'
    cmds:
      - '{{ .MF }} health-checks'
      - '{{ .MF }} validate-configs --verbose-issues'
